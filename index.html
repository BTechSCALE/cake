<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="google" value="notranslate">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cake</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/prettify.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/jquery.terminal.css">
</head>
<body onload="start()">
<div class="header">
    <nav class="navbar navbar-default" role="navigation">
    <div class="container">
    <nav class="navbar navbar-default">
        <div class="collapse navbar-collapse">
            <div class="btn-toolbar" role="toolbar">
                <div class="navbar-header">
                    <img src="cake.png">Cake
                </div>
                <div class="btn-group">
                    <button type="button" data-toggle="modal" data-target="#open" class="btn btn-default navbar-btn">
                        <span class="glyphicon glyphicon-folder-open"></span> Open
                    </button>
                    <button type="button" data-toggle="modal" data-target="#save" class="btn btn-default navbar-btn">
                        <span class="glyphicon glyphicon-floppy-disk"></span> Save
                    </button>
                    <button type="button" data-toggle="modal" data-target="#import" class="btn btn-default navbar-btn">
                        <span class="glyphicon glyphicon-import"></span> Import
                    </button>
                    <button type="button" data-toggle="modal" data-target="#export" class="btn btn-default navbar-btn">
                        <span class="glyphicon glyphicon-export"></span> Export..
                    </button>
                    <button type="button" class="btn btn-default navbar-btn" onclick="downloadCode()">
                        <span class="glyphicon glyphicon-download-alt"></span> Download
                    </button>
                    <button type="button" class="btn btn-default navbar-btn" onclick="discard()" data-toggle="button">
                        <span class="glyphicon glyphicon-trash"></span> Trash
                    </button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default navbar-btn" disabled="disabled">
                        <span class="glyphicon glyphicon-play"></span> Run
                    </button>
                    <button type="button" class="btn btn-default navbar-btn" disabled="disabled">
                        <span class="glyphicon glyphicon-wrench"></span> Setting
                    </button>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-default navbar-btn" disabled="disabled">
                        <span class="glyphicon glyphicon-fullscreen"></span> Fullscreen
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <div id="main-wrapper" class="row">
        <div class="col-xs-8">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Workspace</h3>
                </div>
                <div id="blocklyDiv" class="panel-body"></div>
            </div>
        </div>
        <xml id="toolbox">
            <category name="Functions" custom="PROCEDURE">
                <block type="procedures_defnoreturn"></block>
                <block type="procedures_defreturn"></block>
                <block type="procedures_ifreturn"></block>
            </category>
            <category name="Variables">
                    <block type="variables_declare">
                        <value name="VALUE">
                            <block type="math_number"></block>
                        </value>
                    </block>
                    <block type="variables_get"></block>
                    <block type="variables_set">
                        <value name="VALUE">
                            <block type="math_number"></block>
                        </value>
                    </block>
                </category>
            </category>
            <div class="blocklyTreeSeparator" style="border-left: 8px solid rgb(221, 221, 221); height: 10px;">
                <hr>
            </div>
            <category name="Logic">
                <block type="controls_if">
                    <value name="IF0">
                        <block type="logic_compare"></block>
                    </value>
                </block>
                <block type="logic_compare"></block>
                <block type="logic_operation"></block>
                <block type="logic_negate"></block>
                <block type="logic_boolean"></block>
                <block type="logic_null"></block>
            </category>

            <category name="Loops">
                <block type="controls_whileUntil">
                    <value name="BOOL">
                        <block type="logic_compare"></block>
                    </value>
                </block>
                <block type="controls_doWhile">
                    <value name="BOOL">
                        <block type="logic_compare"></block>
                    </value>
                </block>
                <block type="controls_repeat">
                    <value name="TIMES">
                        <block type="math_number"></block>
                    </value>
                </block>
                <block type="controls_flow_statements"></block>
            </category>

            <category name="Math">
                <block type="math_number"></block>
                <block type="math_arithmetic"></block>
                <block type="math_modulo"></block>
                <block type="library_stdio_char"></block>
                <block type="library_math_trig"></block>
                <block type="library_math_logs"></block>
                <block type="library_math_pow"></block>
                <block type="library_math_round"></block>
            </category>
            <category name="Print">
                <block type="library_stdio_printf">
                    <value name="VAR0">
                        <block type="library_stdio_text"></block>
                    </value>
                </block>
                <block type="library_stdio_text"></block>
                <block type="library_stdio_char"></block>
                <block type='library_stdio_newLine'></block>
            </category>
        </xml>
        <div class="col-xs-4">
            <div id="tabs" class="row">
                <ul>
                    <li><a href="#tabs-code">Code</a></li>
                    <li><a href="#tabs-trace">Execution</a></li>
                </ul>
            <div id="tabs-code" class="panel panel-default">
                <pre id="code" class="panel-body pre-scrollable"></pre>
            </div>
            <div id="tabs-trace">
                <input style="font-family: monospace;" type=text id="exec_function" /> <button class="btn btn-default navbar-btn" id="exec_run"><span class="glyphicon glyphicon-play"></span> Run</button>
                <div id="exec_error" style="color:#e93f34;"><span></span></div>
                <div id="exec_trace">
                </div>
            </div>
            </div>
        </div>
    </div>
    </div>
</nav>
</div>
<footer id="footer" role="contentinfo">
</footer>
<script type="text/javascript" src="blockly/blockly_compressed.js"></script>
<script type="text/javascript" src="blockly/blocks_compressed.js"></script>
<script type="text/javascript" src="blockly/cake_compressed.js"></script>
<script type="text/javascript" src="blockly/pythontutor_compressed.js"></script>
<script type="text/javascript" src="blockly/msg/js/en.js"></script>
<script type="text/javascript" src="blockly/apps/common.js"></script>
<script type="text/javascript" src="blockly/pytutor_compressed.js"></script>
<script type="text/javascript" src="js/code.js"></script>
<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/FileSaver.js"></script>
<script type="text/javascript" src="js/prettify.js"></script>
<script type="text/javascript" src="js/easyj.js"></script>
<script type="text/javascript" src="js/jquery.mousewheel.min.js"></script>
<script type="text/javascript" src="js/jquery.terminal-0.8.8.min.js"></script>
<!-- Load the Google Drive SDK Realtime libraries. -->
<script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
<!-- dependencies for pytutor.js -->
<script type="text/javascript" src="js/d3.v2.min.js"></script>
<script type="text/javascript" src="js/jquery.jsPlumb-1.3.10-all-min.js "></script> <!-- for rendering SVG connectors
                                                                                         DO NOT UPGRADE ABOVE 1.3.10 OR ELSE BREAKAGE WILL OCCUR -->
<script type="text/javascript" src="js/jquery-ui-1.11.4.min.js"></script> <!-- for sliders and other UI elements -->
<link type="text/css" href="js/jquery-ui.min.css" rel="stylesheet" />
<!-- Python Tutor frontend code and styles -->
<link rel="stylesheet" href="css/pytutor.css"/>

<!-- export.html-->
<!-- Modal -->
<div class="modal fade" id="export" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">Export</h4>
			</div>
			<div class="modal-body">
        <p>Download your blocks in the XML format, so later you can restore them using the <a href="#import"  data-dismiss="modal" data-toggle="modal">Import tool</a>.</p>
				<textarea readonly class="xmlcode" onclick="this.select();"></textarea> <!-- @todo Make readonly?-->
				<a href="#" class="downXML">Download XML</a>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function () {
		$(document).on('show.bs.modal', function(event){
			if ($(event.target).attr('id') == 'export') {
				var xmlDom = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
				var xmlText = Blockly.Xml.domToPrettyText(xmlDom);
				$('#export .modal-body textarea').val(xmlText).focus();
			}
		});
		$('#export .modal-body .downXML').click(function() {
			EasyJ.Xml.download($('#export .modal-body textarea').val(), "cake.xml");
        });
        $("#tabs").tabs();
	})
</script>

<!-- import.html-->
<!-- Modal -->
<div class="modal fade" id="import" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">Import</h4>
			</div>
			<div class="modal-body">
        <p>Paste the output of the <a href="#export" data-dismiss="modal" data-toggle="modal">Export tool</a> here to restore your blocks.</p>
				<textarea class="xmlcode"></textarea>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary loadbtn">Load</button> <!-- @todo warn them that all blocks will be lost -->
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function () {
		$('#import .loadbtn').click(function() {
			var toload = $('#import .modal-body textarea').val();

			var success = loadxml(toload);
			if (success) {
				$('#import').modal('hide');
			};
		});
	})
</script>

<!-- open.html-->
<!-- Modal -->
<div class="modal fade" id="open" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">Saved Projects</h4>
			</div>
			<div class="modal-body"><div class="example" data-name="ted">
		<h3><span>MyRobot</span>
			<div class="pull-right inline-block">
				<button type="button" class="btn btn-success load">Open</button>
				<button type="button" class="btn btn-danger remove">Remove</button>
			</div>
		</h3>
		<div class="brief">Description</div>
	</div></div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<div id="examplewrapper" style="display:none">
	<div class="example" data-name="ted">
		<h3><span>Robot Example</span>
			<div class="pull-right inline-block">
				<button type="button" class="btn btn-success load">Open</button>
				<button type="button" class="btn btn-danger remove">Remove</button>
			</div>
		</h3>
		<div class="brief">Description</div>
	</div>
	<!-- <div class="cloneable example">
		<h3>Robot Example
			<div class="inline-block">
				<button type="button" class="btn btn-success load" style="margin-top:10px;" data-name="">Load</button>
			</div>
		</h3>
		<div class="brief">Example showing use of a joystick and the drivetrain block.</div>
	</div> -->
</div>
<script type="text/javascript">

    function handleEmpty () {
      var empty = $("<h3>").text("No saved projects");
      empty.appendTo($('#open .modal-body'));
    }

    function loadbtn (event) {
      var ret = EasyJ.localStorage.open($(this).data('name'));
      if (ret) {
        $("#open").modal('hide');
      }
      // @todo handle errors better
    }
    function removebtn (event) {
      var ret = EasyJ.localStorage.remove($(this).data('name'));
      $(this).closest('.example').remove(); //based on the button pressed remove the parent example div
      if (EasyJ.localStorage.listSaves().length == 0) {
        handleEmpty();
      };
    }


      $(document).ready(function () {

          $(document).on('show.bs.modal', function(event){
              if ($(event.target).attr('id') == 'open') {
                  // build the list of saves. @todo Make is scroll

                  //Clear out the modal body:
                  $('#open .modal-body').html("");

                  var saves = EasyJ.localStorage.listSaves();
                  for (var i = 0; i < saves.length; i++) { //foreach save

                      var clone = $('#examplewrapper div:first').clone()
                      $("h3 span", clone).text(saves[i]);
                      //this doesn't look like it works b/c the value isn't written to the DOM, but the value is cached in jquery internally.
                      $("button.load", clone).data('name', saves[i]).on('click', loadbtn);
                      $("button.remove", clone).data('name', saves[i]).on('click', removebtn);

                      clone.appendTo($('#open .modal-body'));
                  }
                  if (saves.length == 0) {
                      handleEmpty();
                  };
              }
          });

          // $('#save .modal-footer .savebtn').click(function() {
          // 	var xmlDom = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
          // 	var xmlText = Blockly.Xml.domToPrettyText(xmlDom);
          // 	localStorage.setItem('easyj_'+$('#save_filename').val(), xmlText);
          // 	//@todo tell the user that we saved for them!
          // 	$('#save').modal('hide');
          // });
      });
  </script>

<!-- save.html-->
<!-- Modal -->
<div class="modal fade" id="save" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">Save As</h4>
			</div>
			<div class="modal-body">
        <p>Save your project. You'll be able to open it later from this computer.</p>
				<label for="save_filename">Filename:</label>
				<input id="save_filename" type="text" class="form-control" value="filename">

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary savebtn">Save</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function () {

		$(document).on('show.bs.modal', function(event){
			if ($(event.target).attr('id') == 'save') {
				//Put the most recent robot class in the filename
				//@todo cache their filename
				$('#save_filename').val(EasyJ.robotClass);
			}
		});
		$('#save .modal-footer .savebtn').click(function() {
			var xmlDom = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
			var xmlText = Blockly.Xml.domToPrettyText(xmlDom);
			var success = EasyJ.localStorage.addSave($('#save_filename').val(), xmlText);
			if (success) {
				//@todo tell the user that we saved for them!
				$('#save').modal('hide');
			} else {
				//@todo use bootratrap alerts
				if (confirm("That name is alredy taken, overwrite it?")) {
					var success = EasyJ.localStorage.addSave($('#save_filename').val(), xmlText, true);
					if (!success) {
						alert("Well that is an error! \nThis shouldn't happen!");
						//@tell admin
					} else {
						$('#save').modal('hide');
					}
				}
			}

		});
	});
</script>
</body>
</html>